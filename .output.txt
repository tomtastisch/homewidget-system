.....................................................................FFF [ 96%]
...                                                                      [100%]
=================================== FAILURES ===================================
__________________________ test_login_homefeed_logout __________________________
    @pytest.mark.contract
    def test_login_homefeed_logout() -> None:
        with httpx.Client(base_url=BASE_URL, timeout=10.0) as client:
            # Login (OAuth2PasswordRequestForm: username, password)
            login_resp = client.post(
                "/api/auth/login",
                data={"username": "demo@example.com", "password": "demo1234"},
                headers={"Content-Type": "application/x-www-form-urlencoded"},
            )
>           _assert_ok(login_resp, "login")
tests/e2e/contracts/test_login_widgets_logout.py:36:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
resp = <Response [500 Internal Server Error]>, ctx = 'login'
    def _assert_ok(resp: httpx.Response, ctx: str = "") -> None:
        if resp.status_code >= 400:
>           raise AssertionError(
                f"{ctx} expected <400 status, got {resp.status_code}: {resp.text[:500]}"
            )
E           AssertionError: login expected <400 status, got 500: Internal Server Error
tests/e2e/contracts/test_login_widgets_logout.py:22: AssertionError
---------------------------- Captured stdout setup -----------------------------
2025-12-15 16:04:06.589 INFO     backend.app.infrastructure.db [rid=- uid=-] Initializing database schema
2025-12-15 16:04:06.589 INFO     backend.app.infrastructure.db [rid=- uid=-] Database schema ready
2025-12-15 16:04:06.589 INFO     backend.app.lifecycle [rid=- uid=-] cleanup_loop_started
2025-12-15 16:04:06.590 INFO     backend.app.services.maintenance [rid=- uid=-] purged_refresh_tokens
----------------------------- Captured stdout call -----------------------------
2025-12-15 16:04:06.642 INFO     backend.app.api.middleware [rid=aab11cb8-6fdb-46ec-9f9b-e51cfb852aa6 uid=-] response
----------------------------- Captured stderr call -----------------------------
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: no such column: users.role
The above exception was the direct cause of the following exception:
Traceback (most recent call last):
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1139, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/app/middleware/logging_middleware.py", line 37, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 120, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 106, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 430, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 318, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/app/api/routes/auth.py", line 73, in login
    user = service.authenticate(form_data.username, form_data.password)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/app/services/auth_service.py", line 79, in authenticate
    user = self.session.exec(select(User).where(User.email == normalized_email)).first()
           ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlmodel/orm/session.py", line 83, in exec
    results = super().execute(
        statement,
    ...<4 lines>...
        _add_event=_add_event,
    )
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.role
[SQL: SELECT users.id, users.email, users.password_hash, users.role, users.is_active, users.created_at, users.updated_at
FROM users
WHERE users.email = ?]
[parameters: ('demo@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
_________________________ test_register_login_homefeed _________________________
    @pytest.mark.contract
    def test_register_login_homefeed() -> None:
        """Testet vollstÃ¤ndigen Flow: Registrierung -> Login -> Home-Feed."""
        with httpx.Client(base_url=BASE_URL, timeout=10.0) as client:
            # Register mit eindeutiger E-Mail
            import uuid
            test_email = f"test_{uuid.uuid4().hex[:8]}@example.com"
            test_password = "TestPassword123!"

            register_resp = client.post(
                "/api/auth/register",
                json={"email": test_email, "password": test_password},
            )
>           _assert_ok(register_resp, "register")
tests/e2e/contracts/test_register_flow.py:32:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
resp = <Response [500 Internal Server Error]>, ctx = 'register'
    def _assert_ok(resp: httpx.Response, ctx: str = "") -> None:
        if resp.status_code >= 400:
>           raise AssertionError(
                f"{ctx} expected <400 status, got {resp.status_code}: {resp.text[:500]}"
            )
E           AssertionError: register expected <400 status, got 500: Internal Server Error
tests/e2e/contracts/test_register_flow.py:14: AssertionError
----------------------------- Captured stdout call -----------------------------
2025-12-15 16:04:06.716 INFO     backend.app.api.middleware [rid=0b61c94f-78e0-4134-a396-e7d40a2cd319 uid=-] response
----------------------------- Captured stderr call -----------------------------
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: no such column: users.role
The above exception was the direct cause of the following exception:
Traceback (most recent call last):
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1139, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/app/middleware/logging_middleware.py", line 37, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 120, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 106, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 430, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 318, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/app/api/routes/auth.py", line 48, in register
    return _perform_signup(payload, session)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/app/api/routes/auth.py", line 34, in _perform_signup
    user = service.signup(str(payload.email), payload.password)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/app/services/auth_service.py", line 62, in signup
    existing = self.session.exec(select(User).where(User.email == normalized_email)).first()
               ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlmodel/orm/session.py", line 83, in exec
    results = super().execute(
        statement,
    ...<4 lines>...
        _add_event=_add_event,
    )
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.role
[SQL: SELECT users.id, users.email, users.password_hash, users.role, users.is_active, users.created_at, users.updated_at
FROM users
WHERE users.email = ?]
[parameters: ('test_08cf4b6d@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
__________________ test_register_duplicate_email_returns_409 ___________________
    @pytest.mark.contract
    def test_register_duplicate_email_returns_409() -> None:
        """Testet, dass doppelte E-Mail-Registrierung mit 409 abgelehnt wird."""
        with httpx.Client(base_url=BASE_URL, timeout=10.0) as client:
            # Registriere mit bekannter E-Mail
            register_resp = client.post(
                "/api/auth/register",
                json={"email": "demo@example.com", "password": "TestPassword123!"},
            )
>           assert register_resp.status_code == 409, f"expected 409, got {register_resp.status_code}"
E           AssertionError: expected 409, got 500
E           assert 500 == 409
E            +  where 500 = <Response [500 Internal Server Error]>.status_code
tests/e2e/contracts/test_register_flow.py:83: AssertionError
----------------------------- Captured stdout call -----------------------------
2025-12-15 16:04:06.743 INFO     backend.app.api.middleware [rid=fee324a6-2abf-4876-910b-a43c3a14b0be uid=-] response
----------------------------- Captured stderr call -----------------------------
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: no such column: users.role
The above exception was the direct cause of the following exception:
Traceback (most recent call last):
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1139, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/app/middleware/logging_middleware.py", line 37, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 120, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 106, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 430, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 318, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/app/api/routes/auth.py", line 48, in register
    return _perform_signup(payload, session)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/app/api/routes/auth.py", line 34, in _perform_signup
    user = service.signup(str(payload.email), payload.password)
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/app/services/auth_service.py", line 62, in signup
    existing = self.session.exec(select(User).where(User.email == normalized_email)).first()
               ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlmodel/orm/session.py", line 83, in exec
    results = super().execute(
        statement,
    ...<4 lines>...
        _add_event=_add_event,
    )
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.role
[SQL: SELECT users.id, users.email, users.password_hash, users.role, users.is_active, users.created_at, users.updated_at
FROM users
WHERE users.email = ?]
[parameters: ('demo@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
=============================== warnings summary ===============================
backend/tests/auth/sec/test_auth.py:19
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/auth/sec/test_auth.py:19: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/auth/sec/test_security.py:13
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/auth/sec/test_security.py:13: PytestUnknownMarkWarning: Unknown pytest.mark.unit - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.unit
backend/tests/auth/sec/test_token_blacklist.py:16
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/auth/sec/test_token_blacklist.py:16: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/auth/sec/test_token_properties.py:20
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/auth/sec/test_token_properties.py:20: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/auth/sec/test_tokens.py:20
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/auth/sec/test_tokens.py:20: PytestUnknownMarkWarning: Unknown pytest.mark.unit - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.unit
backend/tests/auth/sec/test_tokens.py:120
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/auth/sec/test_tokens.py:120: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration
backend/tests/auth/test_login.py:23
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/auth/test_login.py:23: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/auth/test_parallel_refresh.py:17
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/auth/test_parallel_refresh.py:17: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/auth/test_register.py:22
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/auth/test_register.py:22: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/core/test_health.py:10
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/core/test_health.py:10: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/db/test_db_init.py:14
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/db/test_db_init.py:14: PytestUnknownMarkWarning: Unknown pytest.mark.unit - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.unit
backend/tests/db/test_persistence.py:19
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/db/test_persistence.py:19: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/general/test_timezone.py:13
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/general/test_timezone.py:13: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/widgets/test_contract_v1.py:8
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/widgets/test_contract_v1.py:8: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/widgets/test_demo_feed_fallback.py:9
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/widgets/test_demo_feed_fallback.py:9: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/widgets/test_demo_routes_v1.py:15
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/widgets/test_demo_routes_v1.py:15: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/widgets/test_home_feed.py:8
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/widgets/test_home_feed.py:8: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
backend/tests/widgets/test_widgets_security.py:14
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/tests/widgets/test_widgets_security.py:14: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.integration
tests/e2e/contracts/test_login_widgets_logout.py::test_login_homefeed_logout
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/websockets/legacy/__init__.py:6: DeprecationWarning: websockets.legacy is deprecated; see https://websockets.readthedocs.io/en/stable/howto/upgrade.html for upgrade instructions
    warnings.warn(  # deprecated in 14.0 - 2024-11-09
tests/e2e/contracts/test_login_widgets_logout.py::test_login_homefeed_logout
  /Users/tomwerner/IdeaProjects/homewidget-system/backend/.venv/lib/python3.13/site-packages/uvicorn/protocols/websockets/websockets_impl.py:17: DeprecationWarning: websockets.server.WebSocketServerProtocol is deprecated
    from websockets.server import WebSocketServerProtocol
-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/e2e/contracts/test_login_widgets_logout.py::test_login_homefeed_logout - AssertionError: login expected <400 status, got 500: Internal Server Error
FAILED tests/e2e/contracts/test_register_flow.py::test_register_login_homefeed - AssertionError: register expected <400 status, got 500: Internal Server Error
FAILED tests/e2e/contracts/test_register_flow.py::test_register_duplicate_email_returns_409 - AssertionError: expected 409, got 500
3 failed, 72 passed, 20 warnings in 8.06s
